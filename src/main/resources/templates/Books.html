<!DOCTYPE html>
<html>
<head>
  <title>Bookstore Admin</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; }
    th { background-color: #f4f4f4; }
    input[type="text"], input[type="number"] { margin-right: 10px; }
    button { padding: 6px 12px; }
  </style>
</head>
<body>

<h1>Bookstore Admin</h1>

<h2>Add New Book</h2>
<form id="addBookForm">
  <input type="text" id="title" placeholder="Title" required>
  <input type="text" id="authorNames" placeholder="Author Names (comma separated)" required>
  <input type="text" id="genre" placeholder="Genre" required>
  <input type="text" id="isbn" placeholder="ISBN" required>
  <input type="number" id="pageCount" placeholder="Page Count" required>
  <input type="number" id="price" placeholder="Price" step="0.01" required>
  <input type="text" id="publisherName" placeholder="Publisher Name" required>
  <input type="number" id="quantity" placeholder="Quantity" required>
  <input type="text" id="url" placeholder="URL" required>
  <input type="number" id="year" placeholder="Year" required>
  <button type="submit">Add Book</button>
</form>

<h2>All Books</h2>
<table id="booksTable">
  <thead>
  <tr>
    <th>Title</th>
    <th>Authors</th>
    <th>Genre</th>
    <th>ISBN</th>
    <th>Page Count</th>
    <th>Price</th>
    <th>Publisher</th>
    <th>Quantity</th>
    <th>Year</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody>
  <!-- Rows will be dynamically populated here -->
  </tbody>
</table>

<script>
  $(document).ready(function() {
    // Load the books initially
    loadBooks();

    // Handle Add Book form submission
    $('#addBookForm').on('submit', function(event) {
      event.preventDefault();
      addBook();
    });

    // Use event delegation for edit and delete buttons
    $('#booksTable').on('click', '.edit-button', function() {
      var bookId = $(this).data('id');
      editBook(bookId);
    });

    $('#booksTable').on('click', '.delete-button', function() {
      var bookId = $(this).data('id');
      deleteBook(bookId);
    });
  });

  // Function to load all books and populate the table
  function loadBooks() {
    $.ajax({
      url: '/api/books',
      type: 'GET',
      success: function(books) {
        var tbody = $('#booksTable tbody');
        tbody.empty();
        if (books.length > 0) {
          books.forEach(function(book) {
            // Join author names dynamically if available
            var authors = book.authorNames ? book.authorNames.join(", ") : "No Authors";

            var row = `
                        <tr>
                            <td>${book.title}</td>
                            <td>${authors}</td>
                            <td>${book.genre}</td>
                            <td>${book.isbn}</td>
                            <td>${book.pageCount}</td>
                            <td>${book.price}</td>
                            <td>${book.publisherName}</td>
                            <td>${book.quantity}</td>
                            <td>${book.publicationYear}</td>
                            <td>
                                <button class="edit-button" data-id="${book.id}">Edit</button>
                                <button class="delete-button" data-id="${book.id}">Delete</button>
                            </td>
                        </tr>`;
            tbody.append(row);
          });
        } else {
          tbody.append('<tr><td colspan="10">No books found.</td></tr>');
        }
      },
      error: function(xhr, status, error) {
        alert('Failed to load books: ' + xhr.responseText);
      }
    });
  }

  // Function to add a new book
  function addBook() {
    var title = $('#title').val();
    var authorNames = $('#authorNames').val().split(",").map(item => item.trim());
    var genre = $('#genre').val();
    var isbn = $('#isbn').val();
    var pageCount = $('#pageCount').val();
    var price = $('#price').val();
    var publisherName = $('#publisherName').val();
    var quantity = $('#quantity').val();
    var url = $('#url').val();
    var publicationYear = $('#year').val();

    $.ajax({
      url: '/api/books',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({
        title: title,
        authorNames: authorNames,
        genre: genre,
        isbn: isbn,
        pageCount: pageCount,
        price: price,
        publisherName: publisherName,
        quantity: quantity,
        url: url,
        publicationYear: publicationYear
      }),
      success: function() {
        alert('Book added successfully!');
        $('#addBookForm')[0].reset();
        loadBooks(); // Refresh the table
      },
      error: function(xhr, status, error) {
        alert('Failed to add book: ' + xhr.responseText);
      }
    });
  }

  // Function to delete a book
  function deleteBook(id) {
    if (confirm('Are you sure you want to delete this book?')) {
      $.ajax({
        url: '/api/books/' + id,
        type: 'DELETE',
        success: function() {
          alert('Book deleted successfully!');
          loadBooks(); // Refresh the table
        },
        error: function(xhr, status, error) {
          alert('Failed to delete book: ' + xhr.responseText);
        }
      });
    }
  }

  // Function to edit a book
  function editBook(id) {
    // Fetch existing book details
    $.ajax({
      url: '/api/books/' + id,
      type: 'GET',
      success: function(book) {
        var newTitle = prompt("Edit title:", book.title);
        var newAuthorNames = prompt("Edit author names (comma separated):", book.authorNames.join(", "));
        var newGenre = prompt("Edit genre:", book.genre);
        var newIsbn = prompt("Edit ISBN:", book.isbn);
        var newPageCount = prompt("Edit page count:", book.pageCount);
        var newPrice = prompt("Edit price:", book.price);
        var newPublisherName = prompt("Edit publisher name:", book.publisherName);
        var newQuantity = prompt("Edit quantity:", book.quantity);
        var newUrl = prompt("Edit URL:", book.url);
        var newPublicationYear = prompt("Edit year:", book.publicationYear);

        if (newTitle && newAuthorNames && newGenre && newIsbn && newPageCount && newPrice && newPublisherName && newQuantity && newUrl && newPublicationYear) {
          // Update book details
          $.ajax({
            url: '/api/books/' + id,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify({
              title: newTitle,
              authorNames: newAuthorNames.split(",").map(item => item.trim()),
              genre: newGenre,
              isbn: newIsbn,
              pageCount: parseInt(newPageCount),
              price: parseFloat(newPrice),
              publisherName: newPublisherName,
              quantity: parseInt(newQuantity),
              url: newUrl,
              publicationYear: parseInt(newPublicationYear)
            }),
            success: function() {
              alert('Book updated successfully!');
              loadBooks(); // Refresh the table
            },
            error: function(xhr, status, error) {
              alert('Failed to update book: ' + xhr.responseText);
            }
          });
        }
      },
      error: function(xhr, status, error) {
        alert('Failed to fetch book details: ' + xhr.responseText);
      }
    });
  }
</script>


</body>
</html>